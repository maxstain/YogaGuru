{% extends "base.html" %}
{% block content %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const poseSection = document.getElementById('pose-section');
        const positionSelect = document.getElementById('position-select');
        const positionImage = document.getElementById('position-image');
        const positionPurpose = document.getElementById('position-purpose');
        const startButton = document.getElementById('start-button');
        const openCameraButton = document.getElementById('open-camera-button');
        const positionSteps = document.getElementById('position-steps');
        const cameraSection = document.getElementById('camera-section');
        const closeCameraButton = document.getElementById('close-camera-button');
        const fileInsertion = document.getElementById('file-insertion');
        // Use JSON.parse to ensure valid JS objects
        const positions = JSON.parse('{{ positions | tojson | safe }}');
        const poseInfo = JSON.parse('{{ pose_info | tojson | safe }}');
        let stream = null;

        poseSection.classList.add('flex');
        cameraSection.classList.add('hidden');
        fileInsertion.classList.add('hidden');

        // Update image and description based on the selected position
        positionSelect.addEventListener('change', function () {
            const selectedPosition = this.value;
            if (selectedPosition && positions[selectedPosition]) {
                positionImage.src = `/static/poses/${positions[selectedPosition].image}`;
                positionPurpose.textContent = positions[selectedPosition].purpose;
                positionSteps.innerHTML = '';
                if (positions[selectedPosition].steps && positions[selectedPosition].steps.length > 0) {
                    positions[selectedPosition].steps.forEach(function (step) {
                        const li = document.createElement('li');
                        li.textContent = step;
                        positionSteps.appendChild(li);
                    });
                } else {
                    positionSteps.innerHTML = '<li>No steps available for this position.</li>';
                }
            } else {
                positionImage.src = '/static/Yoga_splash.png';
                positionSteps.innerHTML = '<li>Select a position to see the steps.</li>';
            }
        });

        // Handle start button click
        startButton.addEventListener('click', function () {
            alert('Starting the yoga session!');
        });

        openCameraButton.addEventListener('click', function () {
            poseSection.style.display = 'none';
            cameraSection.style.display = 'flex';
        });

        closeCameraButton.addEventListener('click', function () {
            cameraSection.style.display = 'none';
            poseSection.style.display = 'flex';
        });
    });
</script>
<div class="flex flex-col items-center justify-center gap-5">
    <!-- position dropdown selection -->
    <div class="flex flex-col items-center space-y-4">
        <label for="position-select" class="text-lg text-gray-700 mb-2">
            Select your yoga position to get started
        </label>
        <select id="position-select"
                class="w-full max-w-xs p-2 text-gray-800 bg-gray-100 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
            <option value="" disabled selected>Select a position</option>
            {% for position in positions %}
            <option value="{{ position }}">{{ positions[position].name }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="flex items-center justify-center gap-10">
        <!-- Camera section -->
        <div id="camera-section"
             class="rounded-lg p-8 border border-gray-300 shadow-md bg-white/10 w-[500px] h-[500px] hidden flex-col items-center justify-center">
            <img id="camera-feed" src="{{ url_for('video_feed') }}" width="480" height="360" alt="feed"/>
            <button id="close-camera-button"
                    class="mt-4 px-6 py-2 bg-red-700 text-white font-medium rounded-full shadow-md  hover:bg-red-800 focus:outline-none">
                Close Camera
            </button>
        </div>
        <!-- Pose section -->
        <div id="pose-section"
             class="rounded-lg p-8 border border-gray-300 shadow-md bg-white/10 w-[500px] h-[500px] flex flex-col items-center justify-between">
            {% if pose_info %}
            <p id="position-purpose" class="p-2 text-center font-semibold">Select a position</p>
            <ol id="position-steps" class="list-decimal list-inside text-gray-700 mb-4">
            </ol>
            {% endif %}
            <div class="w-full grid gap-5">
                <div id="file-insertion"
                     class="w-full py-9 bg-gray-50 rounded-2xl border border-gray-300 border-dashed">
                    <div class="grid gap-3">
                        <!-- ...file upload UI... -->
                    </div>
                </div>
                <button
                        id="open-camera-button"
                        class="w-full px-6 py-2 bg-green-700 text-white font-medium rounded-full shadow-md hover:bg-green-800 focus:outline-none"
                >
                    Open Camera
                </button>
            </div>
        </div>
        <!-- position image section -->
        <div class="flex flex-col items-center space-y-4 mt-8">
            <img id="position-image" src="{{ url_for('static', filename='Yoga_splash.png') }}"
                 alt="Yoga Position" class="w-[500px] h-[400px] object-center rounded-lg">
            <button id="start-button"
                    class="mt-4 px-6 py-2 bg-green-700 text-white font-medium rounded-full shadow-md hover:bg-green-800"
            >
                Start
            </button>
        </div>
    </div>
</div>
{% endblock %}